---
title: "COVID-19"
author: "Jingyu Bao"
date: 2020-03-08T13:49:09-04:00
output:
    blogdown::html_page:
        highlight: zenburn
slug: covid-19
draft: false
tags:
  - stats
---

<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
</style>


<p>We are living in the history. COVID-19 has been spreading the world for more than 2 month. It originally started in China. Then more than 100 countries has been affected by the virus.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(kableExtra)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">library</span>(RCurl)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">library</span>(plotly)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">site_link &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://raw.githubusercontent.com/&quot;</span>,</a>
<a class="sourceLine" id="cb2-2" title="2">    <span class="st">&quot;CSSEGISandData/COVID-19/&quot;</span>,</a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="st">&quot;master/csse_covid_19_data/&quot;</span>,</a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="st">&quot;csse_covid_19_time_series/&quot;</span></a>
<a class="sourceLine" id="cb2-5" title="5">)</a>
<a class="sourceLine" id="cb2-6" title="6">confirmed_data &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="kw">getURL</span>(<span class="kw">paste0</span>(site_link, <span class="st">&quot;time_series_19-covid-Confirmed.csv&quot;</span>)))</a>
<a class="sourceLine" id="cb2-7" title="7">recovered_data &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="kw">getURL</span>(<span class="kw">paste0</span>(site_link, <span class="st">&quot;time_series_19-covid-Recovered.csv&quot;</span>)))</a>
<a class="sourceLine" id="cb2-8" title="8">death_data &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="kw">getURL</span>(<span class="kw">paste0</span>(site_link, <span class="st">&quot;time_series_19-covid-Deaths.csv&quot;</span>)))</a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co"># Ref: https://stackoverflow.com/questions/32940580/convert-some-column-classes-in-data-table</span></a>
<a class="sourceLine" id="cb2-11" title="11">cols &lt;-<span class="st"> </span><span class="kw">names</span>(recovered_data)[<span class="dv">5</span><span class="op">:</span><span class="kw">dim</span>(recovered_data)[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb2-12" title="12">recovered_data[, (cols) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">lapply</span>(.SD, as.integer), .SDcols =<span class="st"> </span>cols]</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">confirmed &lt;-<span class="st"> </span><span class="kw">melt</span>(</a>
<a class="sourceLine" id="cb3-2" title="2">    confirmed_data,</a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="dt">id=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="dt">measure=</span><span class="kw">colnames</span>(confirmed_data)[<span class="dv">5</span><span class="op">:</span><span class="kw">dim</span>(confirmed_data)[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="dt">value.factor=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="dt">variable.name =</span> <span class="st">&quot;Date&quot;</span>,</a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="dt">value.name =</span> <span class="st">&quot;Num&quot;</span></a>
<a class="sourceLine" id="cb3-8" title="8">)</a>
<a class="sourceLine" id="cb3-9" title="9">recovered &lt;-<span class="st"> </span><span class="kw">melt</span>(</a>
<a class="sourceLine" id="cb3-10" title="10">    recovered_data,</a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="dt">id=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb3-12" title="12">    <span class="dt">measure=</span><span class="kw">colnames</span>(recovered_data)[<span class="dv">5</span><span class="op">:</span><span class="kw">dim</span>(recovered_data)[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb3-13" title="13">    <span class="dt">value.factor=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-14" title="14">    <span class="dt">variable.name =</span> <span class="st">&quot;Date&quot;</span>,</a>
<a class="sourceLine" id="cb3-15" title="15">    <span class="dt">value.name =</span> <span class="st">&quot;Num&quot;</span></a>
<a class="sourceLine" id="cb3-16" title="16">)</a>
<a class="sourceLine" id="cb3-17" title="17">death &lt;-<span class="st"> </span><span class="kw">melt</span>(</a>
<a class="sourceLine" id="cb3-18" title="18">    death_data,</a>
<a class="sourceLine" id="cb3-19" title="19">    <span class="dt">id=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb3-20" title="20">    <span class="dt">measure=</span><span class="kw">colnames</span>(death_data)[<span class="dv">5</span><span class="op">:</span><span class="kw">dim</span>(death_data)[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb3-21" title="21">    <span class="dt">value.factor=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-22" title="22">    <span class="dt">variable.name =</span> <span class="st">&quot;Date&quot;</span>,</a>
<a class="sourceLine" id="cb3-23" title="23">    <span class="dt">value.name =</span> <span class="st">&quot;Num&quot;</span></a>
<a class="sourceLine" id="cb3-24" title="24">)</a>
<a class="sourceLine" id="cb3-25" title="25"></a>
<a class="sourceLine" id="cb3-26" title="26">confirmed[, Type<span class="op">:</span><span class="er">=</span><span class="st">&#39;confirmed&#39;</span>]</a>
<a class="sourceLine" id="cb3-27" title="27">recovered[, Type<span class="op">:</span><span class="er">=</span><span class="st">&#39;recovered&#39;</span>]</a>
<a class="sourceLine" id="cb3-28" title="28">death[, Type<span class="op">:</span><span class="er">=</span><span class="st">&#39;death&#39;</span>]</a>
<a class="sourceLine" id="cb3-29" title="29"></a>
<a class="sourceLine" id="cb3-30" title="30">data &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(<span class="kw">list</span>(confirmed, recovered, death), <span class="dt">fill =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-31" title="31">data[<span class="kw">is.na</span>(Num), Num<span class="op">:</span><span class="er">=</span><span class="dv">0</span>]</a>
<a class="sourceLine" id="cb3-32" title="32"><span class="co"># data[, Time:=mdy_hm(Time)]</span></a>
<a class="sourceLine" id="cb3-33" title="33">data[, Date<span class="op">:</span><span class="er">=</span><span class="kw">mdy</span>(Date)]</a>
<a class="sourceLine" id="cb3-34" title="34">data[, IsChina<span class="op">:</span><span class="er">=</span><span class="kw">as.factor</span>(<span class="kw">ifelse</span>(<span class="st">`</span><span class="dt">Country/Region</span><span class="st">`</span><span class="op">==</span><span class="st">&#39;Mainland China&#39;</span>, <span class="st">&#39;China&#39;</span>, <span class="st">&#39;OutsideChina&#39;</span>))]</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">kable</span>(<span class="kw">head</span>(data))</a></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
Province/State
</th>
<th style="text-align:left;">
Country/Region
</th>
<th style="text-align:right;">
Lat
</th>
<th style="text-align:right;">
Long
</th>
<th style="text-align:left;">
Date
</th>
<th style="text-align:right;">
Num
</th>
<th style="text-align:left;">
Type
</th>
<th style="text-align:left;">
IsChina
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Anhui
</td>
<td style="text-align:left;">
Mainland China
</td>
<td style="text-align:right;">
31.8257
</td>
<td style="text-align:right;">
117.2264
</td>
<td style="text-align:left;">
2020-01-22
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
confirmed
</td>
<td style="text-align:left;">
China
</td>
</tr>
<tr>
<td style="text-align:left;">
Beijing
</td>
<td style="text-align:left;">
Mainland China
</td>
<td style="text-align:right;">
40.1824
</td>
<td style="text-align:right;">
116.4142
</td>
<td style="text-align:left;">
2020-01-22
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
confirmed
</td>
<td style="text-align:left;">
China
</td>
</tr>
<tr>
<td style="text-align:left;">
Chongqing
</td>
<td style="text-align:left;">
Mainland China
</td>
<td style="text-align:right;">
30.0572
</td>
<td style="text-align:right;">
107.8740
</td>
<td style="text-align:left;">
2020-01-22
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
confirmed
</td>
<td style="text-align:left;">
China
</td>
</tr>
<tr>
<td style="text-align:left;">
Fujian
</td>
<td style="text-align:left;">
Mainland China
</td>
<td style="text-align:right;">
26.0789
</td>
<td style="text-align:right;">
117.9874
</td>
<td style="text-align:left;">
2020-01-22
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
confirmed
</td>
<td style="text-align:left;">
China
</td>
</tr>
<tr>
<td style="text-align:left;">
Gansu
</td>
<td style="text-align:left;">
Mainland China
</td>
<td style="text-align:right;">
36.0611
</td>
<td style="text-align:right;">
103.8343
</td>
<td style="text-align:left;">
2020-01-22
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
confirmed
</td>
<td style="text-align:left;">
China
</td>
</tr>
<tr>
<td style="text-align:left;">
Guangdong
</td>
<td style="text-align:left;">
Mainland China
</td>
<td style="text-align:right;">
23.3417
</td>
<td style="text-align:right;">
113.4244
</td>
<td style="text-align:left;">
2020-01-22
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:left;">
confirmed
</td>
<td style="text-align:left;">
China
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">regional_data &lt;-<span class="st"> </span>data[, .(<span class="dt">TotalNum=</span><span class="kw">sum</span>(Num)), by=.(Type, IsChina, Date)]</a>
<a class="sourceLine" id="cb5-2" title="2">p.line &lt;-<span class="st"> </span><span class="kw">ggplot</span>(regional_data, <span class="kw">aes</span>(<span class="dt">x =</span> Date, <span class="dt">y =</span> TotalNum, <span class="dt">col=</span>Type)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>IsChina)</a>
<a class="sourceLine" id="cb5-4" title="4">p.line.plotly &lt;-<span class="st"> </span><span class="kw">ggplotly</span>(p.line)</a>
<a class="sourceLine" id="cb5-5" title="5">htmlwidgets<span class="op">::</span><span class="kw">saveWidget</span>(</a>
<a class="sourceLine" id="cb5-6" title="6">  p.line.plotly, </a>
<a class="sourceLine" id="cb5-7" title="7">  <span class="kw">paste0</span>(<span class="kw">getwd</span>(), <span class="st">&#39;/static/html/covid-19-line.html&#39;</span>),</a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="dt">background =</span> <span class="st">&#39;grey&#39;</span>,</a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="dt">title=</span><span class="st">&#39;China vs Outside&#39;</span>)</a></code></pre></div>
<center>
<iframe style="height: 500px; width: 1000px; border: none" src="/html/covid-19-line.html">
</iframe>
</center>
<p>Some other analysis.</p>
